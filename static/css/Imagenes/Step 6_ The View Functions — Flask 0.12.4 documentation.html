<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0048)http://flask.pocoo.org/docs/0.12/tutorial/views/ -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Step 6: The View Functions — Flask 0.12.4 documentation</title>
    <link rel="stylesheet" href="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/flask.css" type="text/css">
    <link rel="stylesheet" href="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/pygments.css" type="text/css">
    <script type="text/javascript" src="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/documentation_options.js.descarga"></script>
    <script type="text/javascript" src="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/jquery.js.descarga"></script>
    <script type="text/javascript" src="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/underscore.js.descarga"></script>
    <script type="text/javascript" src="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/doctools.js.descarga"></script>
    <link rel="shortcut icon" href="http://flask.pocoo.org/docs/0.12/_static/flask-favicon.ico">
    <link rel="index" title="Index" href="http://flask.pocoo.org/docs/0.12/genindex/">
    <link rel="search" title="Search" href="http://flask.pocoo.org/docs/0.12/search/">
    <link rel="next" title="Step 7: The Templates" href="http://flask.pocoo.org/docs/0.12/tutorial/templates/">
    <link rel="prev" title="Step 5: Creating The Database" href="http://flask.pocoo.org/docs/0.12/tutorial/dbinit/">
    <link rel="canonical" href="http://flask.pocoo.org/docs/0.12/tutorial/views/">
  <script>DOCUMENTATION_OPTIONS.URL_ROOT = '../../';</script>
   
  <script id="_carbonads_projs" type="text/javascript" src="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/CKYIE277.json"></script></head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="http://flask.pocoo.org/docs/0.12/genindex/" title="General Index" accesskey="I">index</a></li>
        <li class="right">
          <a href="http://flask.pocoo.org/docs/0.12/py-modindex/" title="Python Module Index">modules</a> |</li>
        <li class="right">
          <a href="http://flask.pocoo.org/docs/0.12/tutorial/templates/" title="Step 7: The Templates" accesskey="N">next</a> |</li>
        <li class="right">
          <a href="http://flask.pocoo.org/docs/0.12/tutorial/dbinit/" title="Step 5: Creating The Database" accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="http://flask.pocoo.org/docs/0.12/">Flask 0.12.4 documentation</a> »</li>
          <li class="nav-item nav-item-1"><a href="http://flask.pocoo.org/docs/0.12/tutorial/" accesskey="U">Tutorial</a> »</li> 
      </ul>
    </div>  

    <div class="document">
    <p class="version-warning"><strong>Warning: </strong> This is an old version. The latest stable version is <a href="http://flask.pocoo.org/docs/1.0/tutorial/views/">Flask 1.0</a>.</p>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="step-6-the-view-functions">
<span id="tutorial-views"></span><h1>Step 6: The View Functions<a class="headerlink" href="http://flask.pocoo.org/docs/0.12/tutorial/views/#step-6-the-view-functions" title="Permalink to this headline">¶</a></h1>
<p>Now that the database connections are working, you can start writing the
view functions.  You will need four of them:</p>
<div class="section" id="show-entries">
<h2>Show Entries<a class="headerlink" href="http://flask.pocoo.org/docs/0.12/tutorial/views/#show-entries" title="Permalink to this headline">¶</a></h2>
<p>This view shows all the entries stored in the database.  It listens on the
root of the application and will select title and text from the database.
The one with the highest id (the newest entry) will be on top.  The rows
returned from the cursor look a bit like dictionaries because we are using
the <a class="reference external" href="https://docs.python.org/3/library/sqlite3.html#sqlite3.Row" title="(in Python v3.6)"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlite3.Row</span></code></a> row factory.</p>
<p>The view function will pass the entries to the <code class="file docutils literal notranslate"><span class="pre">show_entries.html</span></code>
template and return the rendered one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_entries</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'select title, text from entries order by id desc'</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'show_entries.html'</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="n">entries</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-new-entry">
<h2>Add New Entry<a class="headerlink" href="http://flask.pocoo.org/docs/0.12/tutorial/views/#add-new-entry" title="Permalink to this headline">¶</a></h2>
<p>This view lets the user add new entries if they are logged in.  This only
responds to <code class="docutils literal notranslate"><span class="pre">POST</span></code> requests; the actual form is shown on the
<cite>show_entries</cite> page.  If everything worked out well, it will
<a class="reference internal" href="http://flask.pocoo.org/docs/0.12/api/#flask.flash" title="flask.flash"><code class="xref py py-func docutils literal notranslate"><span class="pre">flash()</span></code></a> an information message to the next request and
redirect back to the <cite>show_entries</cite> page:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/add'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add_entry</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'logged_in'</span><span class="p">):</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">401</span><span class="p">)</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">'insert into entries (title, text) values (?, ?)'</span><span class="p">,</span>
                 <span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'title'</span><span class="p">],</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'text'</span><span class="p">]])</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">flash</span><span class="p">(</span><span class="s1">'New entry was successfully posted'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">'show_entries'</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that this view checks that the user is logged in (that is, if the
<cite>logged_in</cite> key is present in the session and <code class="docutils literal notranslate"><span class="pre">True</span></code>).</p>
<div class="admonition-security-note admonition">
<p class="first admonition-title">Security Note</p>
<p class="last">Be sure to use question marks when building SQL statements, as done in the
example above.  Otherwise, your app will be vulnerable to SQL injection when
you use string formatting to build SQL statements.
See <a class="reference internal" href="http://flask.pocoo.org/docs/0.12/patterns/sqlite3/#sqlite3"><span class="std std-ref">Using SQLite 3 with Flask</span></a> for more.</p>
</div>
</div>
<div class="section" id="login-and-logout">
<h2>Login and Logout<a class="headerlink" href="http://flask.pocoo.org/docs/0.12/tutorial/views/#login-and-logout" title="Permalink to this headline">¶</a></h2>
<p>These functions are used to sign the user in and out.  Login checks the
username and password against the ones from the configuration and sets the
<cite>logged_in</cite> key for the session.  If the user logged in successfully, that
key is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, and the user is redirected back to the <cite>show_entries</cite>
page.  In addition, a message is flashed that informs the user that he or
she was logged in successfully.  If an error occurred, the template is
notified about that, and the user is asked again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/login'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span> <span class="o">!=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'USERNAME'</span><span class="p">]:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">'Invalid username'</span>
        <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span> <span class="o">!=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">'PASSWORD'</span><span class="p">]:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s1">'Invalid password'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">session</span><span class="p">[</span><span class="s1">'logged_in'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">'You were logged in'</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">'show_entries'</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'login.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>The <cite>logout</cite> function, on the other hand, removes that key from the session
again.  There is a neat trick here: if you use the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict.pop" title="(in Python v3.6)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pop()</span></code></a> method
of the dict and pass a second parameter to it (the default), the method
will delete the key from the dictionary if present or do nothing when that
key is not in there.  This is helpful because now it is not necessary to
check if the user was logged in.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/logout'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
    <span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'logged_in'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">flash</span><span class="p">(</span><span class="s1">'You were logged out'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">'show_entries'</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition-security-note admonition">
<p class="first admonition-title">Security Note</p>
<p>Passwords should never be stored in plain text in a production
system. This tutorial uses plain text passwords for simplicity. If you
plan to release a project based off this tutorial out into the world,
passwords should be both <a class="reference external" href="https://blog.codinghorror.com/youre-probably-storing-passwords-incorrectly/">hashed and salted</a> before being stored in a
database or file.</p>
<p>Fortunately, there are Flask extensions for the purpose of
hashing passwords and verifying passwords against hashes, so adding
this functionality is fairly straight forward. There are also
many general python libraries that can be used for hashing.</p>
<p class="last">You can find a list of recommended Flask extensions
<a class="reference external" href="http://flask.pocoo.org/extensions/">here</a></p>
</div>
<p>Continue with <a class="reference internal" href="http://flask.pocoo.org/docs/0.12/tutorial/templates/#tutorial-templates"><span class="std std-ref">Step 7: The Templates</span></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="http://flask.pocoo.org/docs/0.12/">
              <img class="logo" src="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/flask.png" alt="Logo">
            </a></p>
  <h3>Contents</h3>
  <ul>
<li><a class="reference internal" href="http://flask.pocoo.org/docs/0.12/tutorial/views/#">Step 6: The View Functions</a><ul>
<li><a class="reference internal" href="http://flask.pocoo.org/docs/0.12/tutorial/views/#show-entries">Show Entries</a></li>
<li><a class="reference internal" href="http://flask.pocoo.org/docs/0.12/tutorial/views/#add-new-entry">Add New Entry</a></li>
<li><a class="reference internal" href="http://flask.pocoo.org/docs/0.12/tutorial/views/#login-and-logout">Login and Logout</a></li>
</ul>
</li>
</ul>
<h3>Navigation</h3>
<ul>
  <li><a href="http://flask.pocoo.org/docs/0.12/">Overview</a>
    <ul>
      <li><a href="http://flask.pocoo.org/docs/0.12/tutorial/">Tutorial</a>
        <ul>
          <li>Previous: <a href="http://flask.pocoo.org/docs/0.12/tutorial/dbinit/" title="previous chapter">Step 5: Creating The Database</a>
          </li><li>Next: <a href="http://flask.pocoo.org/docs/0.12/tutorial/templates/" title="next chapter">Step 7: The Templates</a></li></ul>
      </li>
    </ul>
  </li>
</ul>
  <h3>Versions</h3>
  <ul class="versions">
    
      <li><a href="http://flask.pocoo.org/docs/dev/tutorial/views/">Development</a>
    
    
      <span class="note">(unstable)</span>
    
  
    
      </li><li><a href="http://flask.pocoo.org/docs/1.0/tutorial/views/">Flask 1.0</a>
    
    
      <span class="note">(stable)</span>
    
  
    
      </li><li><a href="http://flask.pocoo.org/docs/0.12/tutorial/views/" class="current">Flask 0.12</a>
    
    
  </li></ul>

  <div class="carbon_ads">
    <script async="" src="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/carbon.js.descarga" id="_carbonads_js"></script><div id="carbonads"><span><span class="carbon-wrap"><a href="https://srv.carbonads.net/ads/click/x/GTND42QNCVYIP277CABLYKQMCY7D623EF6SIKZ3JCWSD6KJNCWSI45QKC6BIKKJJCA7I6K3EHJNCLSIZ?segment=placement:pocooorg;" class="carbon-img" target="_blank" rel="noopener"><img src="./Step 6_ The View Functions — Flask 0.12.4 documentation_files/1525189943-38523.png" alt="ads via Carbon" border="0" height="100" width="130" style="max-width: 130px;"></a><a href="https://srv.carbonads.net/ads/click/x/GTND42QNCVYIP277CABLYKQMCY7D623EF6SIKZ3JCWSD6KJNCWSI45QKC6BIKKJJCA7I6K3EHJNCLSIZ?segment=placement:pocooorg;" class="carbon-text" target="_blank" rel="noopener">Limited time offer: Get 10 free Adobe Stock images.</a></span><a href="http://carbonads.net/?utm_source=pocooorg&amp;utm_medium=ad_via_link&amp;utm_campaign=in_unit&amp;utm_term=carbon" class="carbon-poweredby" target="_blank" rel="noopener">ads via Carbon</a></span></div>
  </div>

<div id="searchbox" style="" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="http://flask.pocoo.org/docs/0.12/search/" method="get">
      <input type="text" name="q">
      <input type="submit" value="Go">
      <input type="hidden" name="check_keywords" value="yes">
      <input type="hidden" name="area" value="default">
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        © Copyright 2010 Pallets Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  
</body></html>